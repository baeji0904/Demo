<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ë„¤ì˜¨ ë°°í‹€ì‰½</title>
<style>
  :root{
    --bg:#050816;
    --panel:#090e1f;
    --ink:#e9edff;
    --muted:#9aa3c7;
    --line:#222747;
    --accent:#7aa2ff;
    --accent2:#22c55e;
    --danger:#fb7185;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;
    background:radial-gradient(circle at top,#151b3c 0,#050816 55%);
    color:var(--ink);
    font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto;
  }
  .wrap{
    max-width:1024px;
    margin:0 auto;
    padding:16px;
  }
  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:8px;
  }
  h1{
    margin:0;
    font-size:22px;
    letter-spacing:0.02em;
    display:flex;
    align-items:center;
    gap:8px;
  }
  h1 span.logo-dot{
    width:24px;
    height:24px;
    border-radius:999px;
    background:radial-gradient(circle at 30% 20%,#f97316,#ec4899);
    box-shadow:0 0 16px rgba(236,72,153,.9);
  }
  .subtitle{
    font-size:12px;
    color:var(--muted);
  }
  .row{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }
  .btn{
    padding:8px 12px;
    border:1px solid #2a315e;
    border-radius:999px;
    background:#111834;
    color:var(--ink);
    cursor:pointer;
    font-size:13px;
    line-height:1.2;
    white-space:nowrap;
  }
  .btn-primary{
    background:linear-gradient(180deg,#3650ff,#2330b7);
    border-color:#4a5bff;
  }
  .btn-ghost{
    background:transparent;
    border-color:#2a315e;
    color:var(--muted);
  }
  .btn:disabled{
    opacity:.5;
    cursor:not-allowed;
  }
  .btn-ship{
    display:flex;
    align-items:center;
    justify-content:space-between;
    width:100%;
    padding:6px 10px;
    font-size:12px;
    margin-bottom:4px;
    background:#020617;
    border-color:#1f2937;
  }
  .btn-ship.active{
    background:var(--accent);
    border-color:var(--accent);
    color:#fff;
  }
  .btn-pill{
    padding:4px 10px;
    border-radius:999px;
    border:1px solid #334155;
    background:#020617;
    font-size:12px;
    color:var(--muted);
    cursor:pointer;
  }
  .btn-pill.active{
    background:var(--accent);
    border-color:var(--accent);
    color:#fff;
  }

  .layout{
    display:grid;
    grid-template-columns:minmax(0,3fr) minmax(0,2.3fr);
    gap:14px;
  }
  @media (max-width:880px){
    .layout{grid-template-columns:1fr;}
  }
  .panel{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:18px;
    padding:14px;
    box-shadow:0 18px 40px rgba(0,0,0,.8);
  }
  .game-shell{
    background:#020414;
    border-radius:16px;
    padding:10px;
    border:1px solid #181e3a;
  }
  .hud{
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
    margin:8px 0 6px;
  }
  .tag{
    display:inline-flex;
    gap:6px;
    align-items:center;
    padding:6px 10px;
    border:1px solid #2b325c;
    border-radius:999px;
    background:#10152f;
    color:var(--muted);
    font-size:13px;
  }
  .tag b{
    font-weight:600;
    color:var(--ink);
    min-width:2ch;
    text-align:right;
  }
  .pill-label{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:4px 8px;
    border-radius:999px;
    border:1px solid #334155;
    background:#020617;
    font-size:12px;
    color:var(--muted);
  }
  .status-msg{
    margin-top:6px;
    font-size:13px;
    color:var(--muted);
    min-height:18px;
  }
  .status-msg.positive{color:#4ade80;}
  .status-msg.negative{color:#fb7185;}

  .hint{
    color:var(--muted);
    font-size:13px;
    margin-top:6px;
  }
  .hint ul{
    padding-left:18px;
    margin:4px 0 0;
  }
  .hint li{margin-bottom:2px;}

  footer{
    color:var(--muted);
    font-size:13px;
    margin-top:14px;
    text-align:left;
  }

  .boards{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:12px;
    margin-top:4px;
  }
  @media (max-width:720px){
    .boards{grid-template-columns:1fr;}
  }
  .board-col{
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  .board-title{
    font-size:13px;
    color:var(--muted);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .board-sub{
    font-size:11px;
    opacity:0.8;
  }

  /* ==== ë°”ë‹¤ ë°°ê²½ + ì‚´ì§ ì¶œë ì´ëŠ” ë¬¼ê²° ==== */
  .board-grid{
    position:relative;
    display:grid;
    grid-template-columns:18px repeat(10, minmax(0,1fr));
    grid-template-rows:18px repeat(10, minmax(0,1fr));
    gap:2px;
    padding:4px;
    border-radius:14px;
    background:
      radial-gradient(circle at 18% 12%, rgba(56,189,248,0.55), transparent 60%),
      radial-gradient(circle at 80% 35%, rgba(59,130,246,0.45), transparent 60%),
      radial-gradient(circle at 45% 82%, rgba(14,165,233,0.38), transparent 60%),
      linear-gradient(135deg,#01122a,#02213f,#023e73,#002b5c);
    border:1px solid #1e293b;
    box-shadow:0 10px 25px rgba(0,0,0,.7);
    overflow:hidden;
  }
  .board-grid::before{
    content:"";
    position:absolute;
    inset:-25%;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,255,255,0.12), transparent 55%),
      radial-gradient(circle at 80% 70%, rgba(255,255,255,0.08), transparent 55%);
    opacity:0.55;
    mix-blend-mode:soft-light;
    pointer-events:none;
    transform:translate3d(0,0,0);
    animation:oceanRipple 26s ease-in-out infinite;
  }
  @keyframes oceanRipple{
    0%{transform:translate3d(0,0,0) scale(1);}
    50%{transform:translate3d(12px,-10px,0) scale(1.02);}
    100%{transform:translate3d(0,0,0) scale(1);}
  }

  .board-grid, .cell, .cell *{
    -webkit-user-select:none;
    -moz-user-select:none;
    -ms-user-select:none;
    user-select:none;
  }
  .axis{
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    color:rgba(226,232,240,0.85);
    text-shadow:0 1px 2px rgba(15,23,42,0.9);
    position:relative;
    z-index:1;
  }
  .axis-corner{}

  .cell{
    position:relative;
    aspect-ratio:1/1;
    border-radius:6px;
    border:1px solid rgba(15,23,42,0.85);
    background:transparent;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    color:var(--muted);
    cursor:pointer;
    transition:
      background .12s ease-out,
      border-color .12s ease-out,
      transform .08s ease-out,
      box-shadow .08s ease-out;
    z-index:1;
  }
  .board-enemy .cell:hover{
    transform:translateY(-1px);
    box-shadow:0 6px 12px rgba(15,23,42,0.9);
    border-color:#334155;
    background:rgba(15,23,42,0.35);
  }
  .board-player .cell:hover{
    background:rgba(15,23,42,0.28);
  }

  /* ---- í•¨ì„  ëª¨ì–‘ ---- */
  .cell-ship{
    background:radial-gradient(circle at 30% 15%, #111827,#020617);
    border-color:#020617;
  }
  .cell-ship::before{
    content:"";
    position:absolute;
    inset:18%;
    border-radius:8px;
    background:linear-gradient(180deg,#cbd5e1,#475569);
    box-shadow:
      0 0 0 2px rgba(15,23,42,0.9),
      inset 0 0 4px rgba(15,23,42,0.85);
    opacity:0.95;
  }
  .cell-ship[data-ship-dir="h"][data-ship-seg="head"]::before{
    border-radius:999px 0 0 999px;
  }
  .cell-ship[data-ship-dir="h"][data-ship-seg="tail"]::before{
    border-radius:0 999px 999px 0;
  }
  .cell-ship[data-ship-dir="h"][data-ship-seg="mid"]::before{
    border-radius:0;
  }
  .cell-ship[data-ship-dir="v"][data-ship-seg="head"]::before{
    border-radius:999px 999px 0 0;
  }
  .cell-ship[data-ship-dir="v"][data-ship-seg="tail"]::before{
    border-radius:0 0 999px 999px;
  }
  .cell-ship[data-ship-dir="v"][data-ship-seg="mid"]::before{
    border-radius:0;
  }
  .cell-ship[data-ship-seg="head"]::after{
    content:"";
    position:absolute;
    background:radial-gradient(circle,#e5e7eb,#94a3b8);
    opacity:0.9;
  }
  .cell-ship[data-ship-dir="h"][data-ship-seg="head"]::after{
    width:35%;
    height:40%;
    right:18%;
    top:22%;
    border-radius:999px;
  }
  .cell-ship[data-ship-dir="v"][data-ship-seg="head"]::after{
    width:40%;
    height:35%;
    top:18%;
    left:22%;
    border-radius:999px;
  }

  .cell-hit{
    background:radial-gradient(circle at top,#f97316,#b91c1c);
    color:#fee2e2;
    border-color:#f97316;
    box-shadow:0 0 0 1px rgba(248,113,113,0.7);
  }
  .cell-miss{
    background:rgba(15,23,42,0.9);
    border-style:dotted;
    border-color:#475569;
    color:#64748b;
  }

  .cell-preview-ok{
    box-shadow:0 0 0 2px rgba(34,197,94,0.9);
    border-color:#22c55e !important;
  }
  .cell-preview-bad{
    box-shadow:0 0 0 2px rgba(248,113,113,0.9);
    border-color:#fb7185 !important;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1><span class="logo-dot"></span>ë„¤ì˜¨ ë°°í‹€ì‰½</h1>
      <div class="subtitle">ë„¤ì˜¨ UI ìŠ¤íƒ€ì¼ì˜ ì‹±ê¸€í”Œë ˆì´ ë°°í‹€ì‰½ (ì§ì ‘ ë°°ì¹˜ + ìë™ ë°°ì¹˜ + ìˆ˜ì • ê°€ëŠ¥)</div>
    </div>
    <div class="row">
      <button id="btn-bgm" class="btn btn-ghost">BGM â–¶</button>
      <button id="btn-new" class="btn btn-primary">ìƒˆ ê²Œì„</button>
    </div>
  </header>

  <!-- ğŸ”Š BGM: BGM/Attack of The Trolls.mp3 -->
  <audio id="bgm" preload="auto" loop>
    <source src="BGM/Attack of The Trolls.mp3" type="audio/mpeg">
  </audio>

  <div class="layout">
    <!-- ì™¼ìª½ : ê²Œì„ í™”ë©´ -->
    <section class="panel">
      <div class="hud">
        <span class="tag">ë‚´ í•¨ì„  <b id="player-ships">0</b></span>
        <span class="tag">ì  í•¨ì„  <b id="enemy-ships">0</b></span>
        <span class="tag">ìƒíƒœ <b id="turn-label">-</b></span>
      </div>

      <div class="game-shell">
        <div class="boards">
          <div class="board-col">
            <div class="board-title">
              <span>ì  í•´ì—­</span>
              <span class="board-sub">ê²Œì„ ì¤‘ì—ë§Œ í´ë¦­í•´ì„œ ê³µê²©</span>
            </div>
            <div id="enemy-grid" class="board-grid board-enemy"></div>
          </div>

          <div class="board-col">
            <div class="board-title">
              <span>ë‚´ í•´ì—­</span>
              <span class="board-sub">ë°°ì¹˜ ë‹¨ê³„ì—ì„œ í•¨ëŒ€ë¥¼ ë°°ì¹˜/ìˆ˜ì •</span>
            </div>
            <div id="player-grid" class="board-grid board-player"></div>
          </div>
        </div>
      </div>

      <div id="status" class="status-msg">ìƒˆ ê²Œì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</div>

      <div class="hint">
        <div class="pill-label">ê²Œì„ ê·œì¹™ ìš”ì•½</div>
        <ul>
          <li><b>ë°°ì¹˜ ë‹¨ê³„</b>: ì˜¤ë¥¸ìª½ì—ì„œ í•¨ì„ ì„ ì„ íƒí•˜ê³ , ë‚´ í•´ì—­ì—ì„œ ìœ„ì¹˜ë¥¼ í´ë¦­í•´ ë°°ì¹˜í•©ë‹ˆë‹¤.</li>
          <li>ì¹¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ <b>ë°°ì¹˜ë  ë°°ì˜ ëª¨ì–‘(ê¸¸ì´)</b>ì´ ë¯¸ë¦¬ ë³´ì…ë‹ˆë‹¤.</li>
          <li>ì´ë¯¸ ë°°ì¹˜ëœ ë°°ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ê·¸ ë°°ë¥¼ ì œê±°í•˜ê³  ë‹¤ë¥¸ ìœ„ì¹˜ì— ì¬ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>ëª¨ë“  í•¨ëŒ€ë¥¼ ë°°ì¹˜í•œ ë’¤ <b>â€œë°°ì¹˜ ì™„ë£Œ & ê²Œì„ ì‹œì‘â€</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì „íˆ¬ ì‹œì‘!</li>
          <li>ì „íˆ¬ ì¤‘ì—ëŠ” <b>ì  í•´ì—­</b>ì„ í´ë¦­í•´ í•œ ì¹¸ì”© ê³µê²©í•©ë‹ˆë‹¤.</li>
          <li>ëª…ì¤‘/ë¹—ë‚˜ê°ë§Œ í‘œì‹œë˜ë©°, <b>í•¨ëŒ€ê°€ ì™„ì „íˆ ê²©ì¹¨ëëŠ”ì§€ëŠ” ì„œë¡œ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b></li>
        </ul>
      </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½ : ì •ë³´ / ë°°ì¹˜ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <aside class="panel">
      <div class="row" style="justify-content:space-between;margin-bottom:6px;">
        <span class="pill-label">
          ëª¨ë“œ <strong style="color:#e5e7eb;">ë°°í‹€ì‰½ (Battleship)</strong>
        </span>
        <span class="pill-label">
          í”Œë ˆì´ ë°©ì‹ <span>ì‹±ê¸€ í”Œë ˆì´ (vs ì»´í“¨í„°)</span>
        </span>
      </div>

      <div style="margin-top:8px;font-size:13px;color:var(--muted);line-height:1.4;">
        <div style="font-weight:600;color:var(--ink);margin-bottom:4px;">ë°°ì¹˜ & ì»¨íŠ¸ë¡¤</div>
        <ul style="padding-left:18px;margin:4px 0;">
          <li><b>í•¨ëŒ€ ì„ íƒ</b> ì˜ì—­ì—ì„œ ë°°ì¹˜/ìˆ˜ì •í•  ë°°ë¥¼ ì§ì ‘ ì„ íƒí•©ë‹ˆë‹¤.</li>
          <li><b>ë°©í–¥ ì „í™˜</b>: í˜„ì¬ ì„ íƒëœ í•¨ì„ ì˜ ë°©í–¥(ê°€ë¡œ/ì„¸ë¡œ)ì„ ë°”ê¿‰ë‹ˆë‹¤.</li>
          <li><b>ìë™ ë°°ì¹˜</b>: ë‚´ í•¨ëŒ€ë¥¼ ì „ë¶€ ìë™ìœ¼ë¡œ ëœë¤ ë°°ì¹˜í•©ë‹ˆë‹¤.</li>
          <li><b>ë°°ì¹˜ ì´ˆê¸°í™”</b>: ë‚´ í•¨ëŒ€ ë°°ì¹˜ë¥¼ ëª¨ë‘ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë°°ì¹˜í•©ë‹ˆë‹¤.</li>
        </ul>
      </div>

      <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap;">
        <button id="btn-rotate" class="btn">ë°©í–¥ ì „í™˜</button>
        <button id="btn-auto-place" class="btn">ìë™ ë°°ì¹˜</button>
        <button id="btn-clear" class="btn">ë°°ì¹˜ ì´ˆê¸°í™”</button>
      </div>

      <button id="btn-start" class="btn btn-primary" style="margin-top:8px;width:100%;">ë°°ì¹˜ ì™„ë£Œ & ê²Œì„ ì‹œì‘</button>

      <div id="placement-info" class="status-msg" style="margin-top:8px;">ì˜¤ë¥¸ìª½ì—ì„œ í•¨ì„ ì„ ì„ íƒí•œ ë’¤ ë‚´ í•´ì—­ì—ì„œ ìœ„ì¹˜ë¥¼ í´ë¦­í•´ ë°°ì¹˜í•˜ì„¸ìš”.</div>

      <div style="margin-top:10px;font-size:13px;color:var(--muted);line-height:1.4;">
        <div style="font-weight:600;color:var(--ink);margin-bottom:4px;">AI ë‚œì´ë„</div>
        <div class="row" style="margin-top:4px;gap:6px;">
          <button type="button" class="btn-pill" data-ai-diff="easy">ì´ˆê¸‰</button>
          <button type="button" class="btn-pill" data-ai-diff="medium">ì¤‘ê¸‰</button>
          <button type="button" class="btn-pill" data-ai-diff="hard">ê³ ê¸‰</button>
        </div>
        <p style="margin-top:4px;font-size:12px;color:var(--muted);">
          ë‚œì´ë„ëŠ” ì–¸ì œë“  ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ í›„ í„´ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.
        </p>
      </div>

      <div style="margin-top:10px;font-size:13px;color:var(--muted);line-height:1.4;">
        <div style="font-weight:600;color:var(--ink);margin-bottom:4px;">í•¨ëŒ€ ì„ íƒ</div>
        <div id="ship-list"></div>
      </div>

      <div style="margin-top:10px;font-size:13px;color:var(--muted);line-height:1.4%;">
        <div style="font-weight:600;color:var(--ink);margin-bottom:4px;">í•¨ëŒ€ êµ¬ì„±</div>
        <ul style="padding-left:18px;margin:4px 0;">
          <li>í•­ê³µëª¨í•¨ (5ì¹¸)</li>
          <li>ì „í•¨ (4ì¹¸)</li>
          <li>ìˆœì–‘í•¨ (3ì¹¸)</li>
          <li>ì ìˆ˜í•¨ (3ì¹¸)</li>
          <li>ì´ˆê³„í•¨ (2ì¹¸)</li>
        </ul>
        <p style="margin-top:6px;">
          ì  í•¨ëŒ€ë„ ê°™ì€ êµ¬ì„±ìœ¼ë¡œ ëœë¤ ë°°ì¹˜ë˜ë©°,<br>
          í•¨ëŒ€ê°€ ì–¸ì œ ì™„ì „íˆ ê²©ì¹¨ëëŠ”ì§€ëŠ” <b>ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b>
        </p>
      </div>

      <footer>Â© 2024 Demo_Game â€” ë„¤ì˜¨ ìŠ¤íƒ€ì¼ ë°°í‹€ì‰½ ìƒ˜í”Œ</footer>
    </aside>
  </div>
</div>

<script>
(function(){
  'use strict';

  const BOARD_SIZE = 10;
  const SHIP_DEFS = [
    { name: 'í•­ê³µëª¨í•¨', size: 5 },
    { name: 'ì „í•¨',     size: 4 },
    { name: 'ìˆœì–‘í•¨',   size: 3 },
    { name: 'ì ìˆ˜í•¨',   size: 3 },
    { name: 'ì´ˆê³„í•¨',   size: 2 }
  ];

  const playerShipsEl   = document.getElementById('player-ships');
  const enemyShipsEl    = document.getElementById('enemy-ships');
  const turnLabelEl     = document.getElementById('turn-label');
  const statusBox       = document.getElementById('status');
  const placementInfoEl = document.getElementById('placement-info');

  const shipListEl      = document.getElementById('ship-list');

  const btnNew       = document.getElementById('btn-new');
  const btnAutoPlace = document.getElementById('btn-auto-place');
  const btnClear     = document.getElementById('btn-clear');
  const btnRotate    = document.getElementById('btn-rotate');
  const btnStart     = document.getElementById('btn-start');

  const enemyGridEl  = document.getElementById('enemy-grid');
  const playerGridEl = document.getElementById('player-grid');

  const aiDiffButtons = Array.from(document.querySelectorAll('[data-ai-diff]'));
  const btnBgm        = document.getElementById('btn-bgm');
  const bgmAudio      = document.getElementById('bgm');

  const enemyCells  = [];
  const playerCells = [];

  const game = {
    playerBoard: null,
    enemyBoard: null,
    playerShips: [],
    enemyShips: [],
    phase: 'placing',
    selectedShipIndex: null,
    placingHorizontal: true,
    turn: 'player',
    gameOver: false,
    shots: 0,
    aiDifficulty: 'medium',
    aiTargets: []
  };

  let previewCells = [];
  let bgmPlaying = false;

  function setStatus(msg, type){
    statusBox.textContent = msg || '';
    statusBox.classList.remove('positive','negative');
    if(type === 'good') statusBox.classList.add('positive');
    if(type === 'bad')  statusBox.classList.add('negative');
  }

  /* ==== BGM í† ê¸€ ==== */
  function toggleBgm(){
    if(!bgmAudio){
      setStatus('BGM ì˜¤ë””ì˜¤ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.','bad');
      return;
    }

    // ì£¼ì˜: srcëŠ” source íƒœê·¸ ìª½ì— ìˆìœ¼ë¯€ë¡œ, ë‹¨ìˆœíˆ ì¡´ì¬ ì—¬ë¶€ë§Œ ì²´í¬
    const hasSource = bgmAudio.querySelector('source');
    if(!hasSource){
      setStatus('BGM ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. audio íƒœê·¸ ì•ˆì˜ sourceë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.','bad');
      return;
    }

    if(bgmAudio.paused){
      bgmAudio.play()
        .then(()=>{
          bgmPlaying = true;
          btnBgm.textContent = 'BGM âšâš';
        })
        .catch(err=>{
          console.warn('BGM ì¬ìƒ ì‹¤íŒ¨:', err);
          setStatus('ë¸Œë¼ìš°ì €ê°€ ìë™ ì¬ìƒì„ ë§‰ì•˜ê±°ë‚˜, BGM íŒŒì¼ ê²½ë¡œì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ë” ëˆŒëŸ¬ë³´ê±°ë‚˜, íŒŒì¼ ìœ„ì¹˜/ì´ë¦„ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.','');
        });
    }else{
      bgmAudio.pause();
      bgmPlaying = false;
      btnBgm.textContent = 'BGM â–¶';
    }
  }

  function createEmptyBoard(){
    const board = [];
    for(let r=0;r<BOARD_SIZE;r++){
      const row = [];
      for(let c=0;c<BOARD_SIZE;c++){
        row.push({
          shipIndex: null,
          shipPart: null,
          shipLen: null,
          dir: null,
          hit: false,
          miss: false
        });
      }
      board.push(row);
    }
    return board;
  }

  function buildBoardGrid(container, cellArr, isEnemy){
    container.innerHTML = '';
    cellArr.length = 0;
    const letters = 'ABCDEFGHIJ';

    for(let r=0;r<=BOARD_SIZE;r++){
      for(let c=0;c<=BOARD_SIZE;c++){
        if(r===0 && c===0){
          const corner = document.createElement('div');
          corner.className = 'axis axis-corner';
          container.appendChild(corner);
        }else if(r===0){
          const top = document.createElement('div');
          top.className = 'axis axis-top';
          top.textContent = String(c);
          container.appendChild(top);
        }else if(c===0){
          const left = document.createElement('div');
          left.className = 'axis axis-left';
          left.textContent = letters[r-1];
          container.appendChild(left);
        }else{
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = String(r-1);
          cell.dataset.col = String(c-1);
          if(isEnemy){
            cell.addEventListener('click', onEnemyCellClick);
          }else{
            cell.addEventListener('click', onPlayerCellClick);
            cell.addEventListener('mouseenter', onPlayerCellEnter);
          }
          container.appendChild(cell);
          cellArr.push(cell);
        }
      }
    }
    if(!isEnemy){
      container.addEventListener('mouseleave', clearPreview);
    }
  }

  function buildGrids(){
    buildBoardGrid(enemyGridEl, enemyCells, true);
    buildBoardGrid(playerGridEl, playerCells, false);
  }

  function getRemainingShips(ships){
    if(!ships) return 0;
    let count = 0;
    for(const ship of ships){
      if(ship.hits < ship.size) count++;
    }
    return count;
  }

  function updateHUD(){
    playerShipsEl.textContent = String(getRemainingShips(game.playerShips));
    enemyShipsEl.textContent  = String(getRemainingShips(game.enemyShips));
    if(game.phase === 'placing'){
      turnLabelEl.textContent = 'ë°°ì¹˜ ì¤‘';
    }else if(game.gameOver){
      turnLabelEl.textContent = 'ê²Œì„ ì¢…ë£Œ';
    }else{
      turnLabelEl.textContent = game.turn === 'player' ? 'í”Œë ˆì´ì–´ í„´' : 'ì»´í“¨í„° í„´';
    }
  }

  function allShipsPlaced(){
    return game.playerShips.length > 0 && game.playerShips.every(s => s.placed);
  }

  function placeFleetRandom(board){
    const ships = SHIP_DEFS.map(def => ({
      name:def.name,
      size:def.size,
      hits:0,
      cells:[],
      placed:false
    }));

    for(let i=0;i<ships.length;i++){
      const ship = ships[i];
      let placed = false;
      let attempts = 0;

      while(!placed && attempts < 500){
        attempts++;
        const horizontal = Math.random() < 0.5;
        const maxRow = horizontal ? BOARD_SIZE : BOARD_SIZE - ship.size + 1;
        const maxCol = horizontal ? BOARD_SIZE - ship.size + 1 : BOARD_SIZE;
        const row = Math.floor(Math.random() * maxRow);
        const col = Math.floor(Math.random() * maxCol);

        if(!canPlaceShipHere(board, row, col, ship.size, horizontal)){
          continue;
        }

        ship.cells = [];
        for(let k=0;k<ship.size;k++){
          const r = row + (horizontal ? 0 : k);
          const c = col + (horizontal ? k : 0);
          const cell = board[r][c];
          cell.shipIndex = i;
          cell.shipPart  = k;
          cell.shipLen   = ship.size;
          cell.dir       = horizontal ? 'h' : 'v';
          ship.cells.push({row:r,col:c});
        }
        ship.placed = true;
        placed = true;
      }
    }
    return ships;
  }

  function renderBoards(){
    renderBoard(game.enemyBoard, enemyCells, true);
    renderBoard(game.playerBoard, playerCells, false);
  }

  function renderBoard(board, cells, isEnemy){
    if(!board) return;

    for(let r=0;r<BOARD_SIZE;r++){
      for(let c=0;c<BOARD_SIZE;c++){
        const cellState = board[r][c];
        const idx = r * BOARD_SIZE + c;
        const cellEl = cells[idx];

        const hasShip = cellState.shipIndex !== null;
        const hit = cellState.hit;
        const miss = cellState.miss;

        const classes = ['cell'];

        if(hit && hasShip){
          classes.push('cell-hit');
        }else if(miss){
          classes.push('cell-miss');
        }else if(hasShip && !isEnemy){
          classes.push('cell-ship');
        }

        cellEl.className = classes.join(' ');

        if(hasShip && !isEnemy){
          const dir = cellState.dir || 'h';
          const len = cellState.shipLen || 1;
          const part = cellState.shipPart || 0;
          let seg = 'mid';
          if(part === 0) seg = 'head';
          else if(part === len - 1) seg = 'tail';
          cellEl.dataset.shipDir = dir;
          cellEl.dataset.shipSeg = seg;
        }else{
          delete cellEl.dataset.shipDir;
          delete cellEl.dataset.shipSeg;
        }

        let symbol = '';
        if(hit && hasShip){
          symbol = 'âœ•';
        }else if(miss){
          symbol = 'â€¢';
        }
        cellEl.textContent = symbol;
      }
    }
  }

  function coordToLabel(row, col){
    const letters = 'ABCDEFGHIJ';
    return letters[row] + '-' + (col + 1);
  }

  function checkAllSunk(ships){
    return getRemainingShips(ships) === 0;
  }

  function updatePlacementInfo(){
    if(game.phase !== 'placing'){
      placementInfoEl.textContent = 'ë°°ì¹˜ëŠ” ê²Œì„ ì‹œì‘ ì „ì—ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆ ê²Œì„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      btnRotate.disabled = true;
      btnAutoPlace.disabled = true;
      btnClear.disabled = true;
      btnStart.disabled = true;
      return;
    }

    btnRotate.disabled = false;
    btnAutoPlace.disabled = false;
    btnClear.disabled = false;

    if(allShipsPlaced()){
      placementInfoEl.textContent = 'ëª¨ë“  í•¨ëŒ€ ë°°ì¹˜ ì™„ë£Œ! "ë°°ì¹˜ ì™„ë£Œ & ê²Œì„ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.';
      btnStart.disabled = false;
    }else{
      btnStart.disabled = true;
      if(game.selectedShipIndex === null){
        placementInfoEl.textContent = 'ì˜¤ë¥¸ìª½ì—ì„œ ë°°ì¹˜/ìˆ˜ì •í•  í•¨ì„ ì„ ì„ íƒí•œ ë’¤ ë‚´ í•´ì—­ì„ í´ë¦­í•´ ì£¼ì„¸ìš”.';
      }else{
        const ship = game.playerShips[game.selectedShipIndex];
        const dirLabel = game.placingHorizontal ? 'ê°€ë¡œ' : 'ì„¸ë¡œ';
        placementInfoEl.textContent =
          'ì„ íƒëœ í•¨ì„ : ' + ship.name + ' (' + ship.size + 'ì¹¸), ë°©í–¥: ' + dirLabel +
          '. ë‚´ í•´ì—­ì—ì„œ ì‹œì‘ ìœ„ì¹˜ë¥¼ í´ë¦­í•´ ë°°ì¹˜í•˜ì„¸ìš”.';
      }
    }
  }

  function renderShipList(){
    shipListEl.innerHTML = '';
    game.playerShips.forEach((ship, idx)=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn btn-ship';
      btn.dataset.index = String(idx);

      const status = ship.placed ? 'ë°°ì¹˜ ì™„ë£Œ' : 'ë¯¸ë°°ì¹˜';

      btn.innerHTML =
        '<span>' + (idx+1) + '. ' + ship.name + ' (' + ship.size + ')</span>' +
        '<span>' + status + '</span>';

      if(game.selectedShipIndex === idx){
        btn.classList.add('active');
      }

      btn.addEventListener('click', onShipSelect);
      shipListEl.appendChild(btn);
    });
  }

  function clearPlayerPlacement(){
    game.playerBoard = createEmptyBoard();
    game.playerShips.forEach(ship=>{
      ship.cells = [];
      ship.hits = 0;
      ship.placed = false;
    });
    game.phase = 'placing';
    game.selectedShipIndex = 0;
    clearPreview();
    setStatus('í•¨ëŒ€ ë°°ì¹˜ë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë°°ì¹˜í•´ ì£¼ì„¸ìš”.','');
    renderBoards();
    renderShipList();
    updateHUD();
    updatePlacementInfo();
  }

  function autoPlacePlayerFleet(){
    if(game.phase !== 'placing') return;
    game.playerBoard = createEmptyBoard();
    game.playerShips = placeFleetRandom(game.playerBoard);
    game.selectedShipIndex = 0;
    clearPreview();
    setStatus('ë‚´ í•¨ëŒ€ë¥¼ ìë™ìœ¼ë¡œ ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ë©´ ë°°ë¥¼ í´ë¦­í•´ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.','good');
    renderBoards();
    renderShipList();
    updateHUD();
    updatePlacementInfo();
  }

  function canPlaceShipHere(board, row, col, size, horizontal){
    const maxRow = horizontal ? BOARD_SIZE : BOARD_SIZE - size + 1;
    const maxCol = horizontal ? BOARD_SIZE - size + 1 : BOARD_SIZE;
    if(row < 0 || col < 0 || row >= maxRow || col >= maxCol){
      return false;
    }
    for(let k=0;k<size;k++){
      const r = row + (horizontal ? 0 : k);
      const c = col + (horizontal ? k : 0);
      if(board[r][c].shipIndex !== null){
        return false;
      }
    }
    return true;
  }

  function placeShipAt(shipIndex, row, col){
    const ship = game.playerShips[shipIndex];
    const size = ship.size;
    const horizontal = game.placingHorizontal;

    if(!canPlaceShipHere(game.playerBoard, row, col, size, horizontal)){
      return false;
    }

    ship.cells = [];
    for(let k=0;k<size;k++){
      const r = row + (horizontal ? 0 : k);
      const c = col + (horizontal ? k : 0);
      const cell = game.playerBoard[r][c];
      cell.shipIndex = shipIndex;
      cell.shipPart  = k;
      cell.shipLen   = size;
      cell.dir       = horizontal ? 'h' : 'v';
      ship.cells.push({row:r,col:c});
    }
    ship.placed = true;
    ship.hits = 0;
    return true;
  }

  function removeShipFromBoard(shipIndex){
    const ship = game.playerShips[shipIndex];
    ship.hits = 0;
    if(!ship.cells || !ship.cells.length) return;
    for(const pos of ship.cells){
      const cell = game.playerBoard[pos.row][pos.col];
      if(cell.shipIndex === shipIndex){
        cell.shipIndex = null;
        cell.shipPart  = null;
        cell.shipLen   = null;
        cell.dir       = null;
      }
    }
    ship.cells = [];
    ship.placed = false;
  }

  function startBattle(){
    if(game.phase !== 'placing') return;
    if(!allShipsPlaced()){
      setStatus('ë¨¼ì € ëª¨ë“  í•¨ëŒ€ë¥¼ ë°°ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë¯¸ë°°ì¹˜ í•¨ì„ ì´ ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤.','bad');
      return;
    }
    game.enemyBoard = createEmptyBoard();
    game.enemyShips = placeFleetRandom(game.enemyBoard);

    game.phase = 'playing';
    game.turn = 'player';
    game.gameOver = false;
    game.shots = 0;
    game.aiTargets = [];

    clearPreview();
    setStatus('ê²Œì„ ì‹œì‘! ì  í•´ì—­ì„ í´ë¦­í•´ ê³µê²©í•˜ì„¸ìš”.','good');
    renderBoards();
    renderShipList();
    updateHUD();
    updatePlacementInfo();
  }

  function newGame(){
    game.playerBoard = createEmptyBoard();
    game.enemyBoard = null;
    game.playerShips = SHIP_DEFS.map(def => ({
      name:def.name,
      size:def.size,
      hits:0,
      cells:[],
      placed:false
    }));
    game.enemyShips = [];
    game.phase = 'placing';
    game.selectedShipIndex = 0;
    game.placingHorizontal = true;
    game.turn = 'player';
    game.gameOver = false;
    game.shots = 0;
    game.aiTargets = [];

    clearPreview();
    setStatus('í•¨ëŒ€ë¥¼ ë°°ì¹˜í•´ ì£¼ì„¸ìš”. ì˜¤ë¥¸ìª½ì—ì„œ í•¨ì„ ì„ ì„ íƒí•˜ê³  ë‚´ í•´ì—­ì„ í´ë¦­í•˜ë©´ ë°°ì¹˜ë©ë‹ˆë‹¤.','');
    renderBoards();
    renderShipList();
    updateHUD();
    updatePlacementInfo();
    updateAiButtons();
  }

  function onEnemyCellClick(e){
    const cellEl = e.currentTarget;
    const row = Number(cellEl.dataset.row);
    const col = Number(cellEl.dataset.col);

    if(game.phase !== 'playing'){
      setStatus('ë¨¼ì € ë‚´ í•¨ëŒ€ë¥¼ ëª¨ë‘ ë°°ì¹˜í•˜ê³  ê²Œì„ì„ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.','');
      return;
    }
    if(game.gameOver){
      setStatus('ê²Œì„ì´ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ê²Œì„ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.','');
      return;
    }
    if(game.turn !== 'player'){
      setStatus('ì§€ê¸ˆì€ ì»´í“¨í„° ì°¨ë¡€ì…ë‹ˆë‹¤.','');
      return;
    }

    playerFire(row, col);
  }

  function onPlayerCellClick(e){
    const row = Number(e.currentTarget.dataset.row);
    const col = Number(e.currentTarget.dataset.col);

    if(game.phase !== 'placing') return;

    const cellState = game.playerBoard[row][col];

    if(cellState.shipIndex !== null){
      const idx = cellState.shipIndex;
      removeShipFromBoard(idx);
      game.selectedShipIndex = idx;
      clearPreview();
      setStatus(game.playerShips[idx].name + ' ì„(ë¥¼) ë‹¤ì‹œ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.','');
      renderBoards();
      renderShipList();
      updateHUD();
      updatePlacementInfo();
      return;
    }

    if(game.selectedShipIndex === null){
      setStatus('ë¨¼ì € ì˜¤ë¥¸ìª½ì—ì„œ ë°°ì¹˜í•  í•¨ì„ ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.','');
      return;
    }

    const shipIndex = game.selectedShipIndex;
    const ship = game.playerShips[shipIndex];

    if(ship.placed){
      setStatus('ì´ í•¨ì„ ì€ ì´ë¯¸ ë°°ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì •í•˜ë ¤ë©´ ë³´ë“œ ìœ„ì˜ í•´ë‹¹ í•¨ì„ ì„ í´ë¦­í•´ ì£¼ì„¸ìš”.','');
      return;
    }

    if(placeShipAt(shipIndex, row, col)){
      clearPreview();
      setStatus(ship.name + ' ë°°ì¹˜ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.','good');
      renderBoards();
      renderShipList();
      updateHUD();
      updatePlacementInfo();
    }else{
      setStatus('ê·¸ ìœ„ì¹˜ì—ëŠ” ë°°ë¥¼ ë†“ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ê±°ë‚˜ ë‹¤ë¥¸ ë°°ì™€ ê²¹ì¹©ë‹ˆë‹¤.)','bad');
    }
  }

  function playerFire(row, col){
    if(game.phase !== 'playing') return;
    const cell = game.enemyBoard[row][col];

    if(cell.hit || cell.miss){
      setStatus('ì´ë¯¸ ê³µê²©í•œ ì¹¸ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.','');
      return;
    }

    const coord = coordToLabel(row, col);

    if(cell.shipIndex !== null){
      cell.hit = true;
      const ship = game.enemyShips[cell.shipIndex];
      ship.hits++;
      setStatus('ëª…ì¤‘! (' + coord + ')','good');
    }else{
      cell.miss = true;
      setStatus('(' + coord + ') ì€(ëŠ”) ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤.','');
    }

    game.shots++;
    renderBoards();
    updateHUD();

    if(checkAllSunk(game.enemyShips)){
      game.gameOver = true;
      setStatus('ì  í•¨ëŒ€ë¥¼ ëª¨ë‘ ê²©ì¹¨í–ˆìŠµë‹ˆë‹¤! ìŠ¹ë¦¬ì…ë‹ˆë‹¤.','good');
      updateHUD();
      renderBoards();
      return;
    }

    game.turn = 'enemy';
    updateHUD();

    setTimeout(aiTurn, 650);
  }

  function chooseAiTarget(){
    const board = game.playerBoard;
    if(!board) return null;

    const all = [];
    for(let r=0;r<BOARD_SIZE;r++){
      for(let c=0;c<BOARD_SIZE;c++){
        const cell = board[r][c];
        if(!cell.hit && !cell.miss){
          all.push({row:r,col:c});
        }
      }
    }
    if(!all.length) return null;

    const diff = game.aiDifficulty;

    if(diff === 'easy'){
      return all[Math.floor(Math.random()*all.length)];
    }

    if(game.aiTargets.length){
      return game.aiTargets.shift();
    }

    if(diff === 'hard'){
      const parity = [];
      for(const p of all){
        if((p.row + p.col) % 2 === 0){
          parity.push(p);
        }
      }
      if(parity.length){
        return parity[Math.floor(Math.random()*parity.length)];
      }
    }

    return all[Math.floor(Math.random()*all.length)];
  }

  function enqueueAiTargets(row, col){
    const board = game.playerBoard;
    if(!board) return;
    const dirs = [[-1,0],[1,0],[0,-1],[0,1]];
    for(const d of dirs){
      const nr = row + d[0];
      const nc = col + d[1];
      if(nr<0 || nr>=BOARD_SIZE || nc<0 || nc>=BOARD_SIZE) continue;
      const cell = board[nr][nc];
      if(cell.hit || cell.miss) continue;
      if(game.aiTargets.some(t => t.row===nr && t.col===nc)) continue;
      game.aiTargets.push({row:nr,col:nc});
    }
  }

  function aiTurn(){
    if(game.phase !== 'playing' || game.gameOver) return;

    const choice = chooseAiTarget();
    if(!choice){
      game.turn = 'player';
      updateHUD();
      return;
    }

    const row = choice.row;
    const col = choice.col;
    const cell = game.playerBoard[row][col];
    const coord = coordToLabel(row, col);

    if(cell.shipIndex !== null){
      cell.hit = true;
      const ship = game.playerShips[cell.shipIndex];
      ship.hits++;
      setStatus('ì»´í“¨í„°ê°€ ' + coord + ' ì„(ë¥¼) ê³µê²©í•´ ëª…ì¤‘í–ˆìŠµë‹ˆë‹¤!','bad');

      if(game.aiDifficulty === 'medium' || game.aiDifficulty === 'hard'){
        enqueueAiTargets(row, col);
      }
    }else{
      cell.miss = true;
      setStatus('ì»´í“¨í„°ê°€ ' + coord + ' ì„(ë¥¼) ê³µê²©í–ˆì§€ë§Œ ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤.','');
    }

    renderBoards();
    updateHUD();

    if(checkAllSunk(game.playerShips)){
      game.gameOver = true;
      setStatus('ë‚´ ëª¨ë“  í•¨ëŒ€ê°€ ê²©ì¹¨ë‹¹í–ˆìŠµë‹ˆë‹¤... íŒ¨ë°°ì…ë‹ˆë‹¤.','bad');
      updateHUD();
      renderBoards();
      return;
    }

    game.turn = 'player';
    updateHUD();
  }

  function onShipSelect(e){
    const idx = Number(e.currentTarget.dataset.index);
    if(isNaN(idx)) return;

    if(game.phase !== 'placing'){
      setStatus('ë°°ì¹˜ëŠ” ê²Œì„ ì‹œì‘ ì „ì—ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.','');
      return;
    }

    game.selectedShipIndex = idx;
    clearPreview();
    const ship = game.playerShips[idx];
    setStatus(ship.name + ' ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤. ë‚´ í•´ì—­ì—ì„œ ë°°ì¹˜ ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”.','');
    renderShipList();
    updatePlacementInfo();
  }

  function onPlayerCellEnter(e){
    const row = Number(e.currentTarget.dataset.row);
    const col = Number(e.currentTarget.dataset.col);
    showPreview(row, col);
  }

  function clearPreview(){
    if(!previewCells.length) return;
    for(const pos of previewCells){
      if(pos.row < 0 || pos.col < 0 || pos.row >= BOARD_SIZE || pos.col >= BOARD_SIZE) continue;
      const idx = pos.row * BOARD_SIZE + pos.col;
      const cellEl = playerCells[idx];
      if(!cellEl) continue;
      cellEl.classList.remove('cell-preview-ok','cell-preview-bad');
    }
    previewCells = [];
  }

  function showPreview(row, col){
    clearPreview();
    if(game.phase !== 'placing') return;
    if(game.selectedShipIndex === null) return;

    const ship = game.playerShips[game.selectedShipIndex];
    if(!ship || ship.placed) return;

    const size = ship.size;
    const horizontal = game.placingHorizontal;

    const ok = canPlaceShipHere(game.playerBoard, row, col, size, horizontal);
    const cls = ok ? 'cell-preview-ok' : 'cell-preview-bad';

    for(let k=0;k<size;k++){
      const r = row + (horizontal ? 0 : k);
      const c = col + (horizontal ? k : 0);
      previewCells.push({row:r,col:c});
      if(r < 0 || c < 0 || r >= BOARD_SIZE || c >= BOARD_SIZE) continue;
      const idx = r * BOARD_SIZE + c;
      const cellEl = playerCells[idx];
      if(!cellEl) continue;
      cellEl.classList.add(cls);
    }
  }

  function updateAiButtons(){
    aiDiffButtons.forEach(btn=>{
      const diff = btn.dataset.aiDiff;
      if(diff === game.aiDifficulty){
        btn.classList.add('active');
      }else{
        btn.classList.remove('active');
      }
    });
  }

  function setAiDifficulty(diff){
    if(diff !== 'easy' && diff !== 'medium' && diff !== 'hard') return;
    game.aiDifficulty = diff;
    game.aiTargets = [];
    updateAiButtons();
    const label = diff === 'easy' ? 'ì´ˆê¸‰' : diff === 'medium' ? 'ì¤‘ê¸‰' : 'ê³ ê¸‰';
    setStatus('AI ë‚œì´ë„ë¥¼ ' + label + ' ìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.','');
  }

  /* ========= ì´ˆê¸°í™” ========= */

  buildGrids();

  btnNew.addEventListener('click', newGame);
  btnAutoPlace.addEventListener('click', autoPlacePlayerFleet);
  btnClear.addEventListener('click', clearPlayerPlacement);
  btnRotate.addEventListener('click', function(){
    if(game.phase !== 'placing') return;
    game.placingHorizontal = !game.placingHorizontal;
    const dir = game.placingHorizontal ? 'ê°€ë¡œ' : 'ì„¸ë¡œ';
    setStatus('í•¨ì„  ë°©í–¥ì„ ' + dir + 'ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.','');
    updatePlacementInfo();
  });
  btnStart.addEventListener('click', startBattle);

  aiDiffButtons.forEach(btn=>{
    btn.addEventListener('click', function(){
      const diff = btn.dataset.aiDiff;
      setAiDifficulty(diff);
    });
  });

  if(btnBgm){
    btnBgm.addEventListener('click', toggleBgm);
  }

  newGame();
})();
</script>
</body>
</html>
